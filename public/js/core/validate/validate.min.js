define(function(require,exports){"use strict";var e=require("tool"),t={trim:!0,validOnChange:!1,allowEmpty:!0,async:!0,errorClass:null,successClass:null,msg:null,msgId:null,successFunction:null,errorFunction:null,min:null,max:null,separator:null,format:null,negative:null},r=0,n={},a={};exports.vaildRule=function(t,r,a,i){var l;if(i&&(l=n[i],!l))return e.logMsg("没有定义该规则!"),!0;var s;if(i&&(a.type=i),s=3==l.length?l(t,r,a):l(t,a),!s){if(a.errorClass&&r&&r.addClass(a.errorClass),a.errorClass&&a.msgId){var o=$(a.msgId);o.addClass(a.errorClass).html(a.msg)}if(a.errorFunction){var u=function(){a.errorFunction(r,a)};a.async?setTimeout(u,1):u()}return!1}return!0},exports.vaildVal=function(t,r,n){if(n.type){var a=n.type;"string"==typeof n.type&&(a=[n.type]);for(var i={},l=0;l<a.length;l++)if(!i[a[l]]){if(!exports.vaildRule(t,r,n,a[l]))return!1;i[a[l]]=1}}else e.logMsg("请选择验证规则类型!");return!0},exports.vaildSingle=function(e){var t=e.attr("validator");if(!t)return!0;var r,n=a[t];switch(e[0].tagName){case"SELECT":r=e.val();break;default:r=e[0].value}for(var i=[],l=0;l<n.length;l++){var s={};if(n[l].trim&&(r=$.trim(r)),!exports.vaildVal(r,e,n[l]))return!1;i.push(s)}for(var l=0;l<n.length;l++){var o=n[l];if(o.errorClass&&e&&e.removeClass(o.errorClass),o.errorClass&&o.msgId){var u=$(o.msgId);u.removeClass(o.errorClass).html("")}if(o.successFunction){var g=i[l],m=function(){o.successFunction(e,g)};o.async?setTimeout(m,1):m()}}return!0},exports.validate=function(e,t){if("object"==typeof t){var r={};return void(_validOneTarget(e,null,t,r)&&t.successFunction&&(t.async?setTimeout(function(){t.successFunction(e,r)},1):t.successFunction(e,r)))}"boolean"!=typeof t&&(t=!0);var n=$(e),a=n[0].tagName.toUpperCase();switch(a){case"SELECT":case"INPUT":case"TEXTAREA":return exports.vaildSingle(n)}for(var i=n.find("select[validator],input[validator],textarea[validator]"),l=!0,s=0;s<i.length;s++)if(!exports.vaildSingle($(i[s]))){if(t)return!1;l=!1}return l},exports.bind=function(e,n){var i=[],l=$(e);n=$.extend({},t,n),n.validOnChange&&l.change(function(){exports.validate(this,!0)});for(var s=0;s<l.length;s++){var o=$(l[s]),u=o.attr("validator");u||(u="validator"+ ++r+(new Date).getTime(),o.attr("validator",u)),a[u]||(a[u]=[]),a[u].push(n),i.push(u)}return i},exports.register=function(e,t){n[e]=t},exports.get=function(e){return n[e]},exports.register("regex",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:r.regex?r.regex.test(t):(e.logMsg("正则匹配不存在!"),!1)}),exports.register("require",function(t,r){return r.allowEmpty=!1,!e.isEmpty(t)}),exports.register("email",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:e.isEmail(t,r.separater)}),exports.register("mobile",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:e.isMobile(t,r.separater)}),exports.register("phone",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:e.isPhone(t,r.separater)}),exports.register("date",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:new Date(t).getDate()==t.substring(t.length-2)}),exports.register("chinese",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:(r.regex=/^[\u4E00-\u9FA5]+$/,exports.get("regex")(t,r))}),exports.register("int",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:(r.regex=r.negative?/^[-]?\d+$/:/^\d+$/,exports.get("regex")(t,r))}),exports.register("float",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:(r.regex=r.negative?/^[-]?\d+(\.\d+)?$/:/^\d+(\.\d+)?$/,exports.get("regex")(t,r))}),exports.register("eq",function(t,r){if(r.allowEmpty&&e.isEmpty(t))return!0;if(!r.compareTo)return e.logMsg("请指定要比较的对象！"),!1;var n,a=$(r.compareTo).val();return r.format?(n=exports.get("date"),n(t,r)&&n(a,r)?new Date(t).getTime()==new Date(a).getTime():!1):t==a}),exports.register("lt",function(t,r){if(r.allowEmpty&&e.isEmpty(t))return!0;if(!r.compareTo)return e.logMsg("请指定要比较的对象！"),!1;var n,a,i=$(r.compareTo).val();return r.format?(a=exports.get("date"),a(t,r)&&a(i,r)?new Date(t).getTime()<new Date(i).getTime():!1):(r.negative=!0,(n=exports.get("float"))(t,r)&&n(i,r)?(t=parseFloat(t),i=parseFloat(i),i>t):!1)}),exports.register("le",function(e,t){var r=exports.get("eq"),n=exports.get("lt");return r(e,t)||n(e,t)}),exports.register("gt",function(t,r){if(r.allowEmpty&&e.isEmpty(t))return!0;if(!r.compareTo)return e.logMsg("请指定要比较的对象！"),!1;var n,a,i=$(r.compareTo).val();return r.format?(a=exports.get("date"),a(t,r)&&a(i,r)?new Date(t).getTime()>new Date(i).getTime():!1):(r.negative=!0,(n=exports.get("float"))(t,r)&&n(i,r)?(t=parseFloat(t),i=parseFloat(i),t>i):!1)}),exports.register("ge",function(e,t){var r=exports.get("eq"),n=exports.get("gt");return r(e,t)||n(e,t)}),exports.register("length",function(t,r){if(r.allowEmpty&&e.isEmpty(t))return!0;if(!r.min&&!r.max)return e.logMsg("请指定长度范围！"),!1;var n=e.len(t);return r.min&&n<r.min?!1:r.max&&n>r.max?!1:!0}),exports.register("range",function(t,r){if(r.allowEmpty&&e.isEmpty(t))return!0;if(!r.min&&!r.max)return e.logMsg("请指定数字范围！"),!1;r.negative=!0;var n=exports.get("float");return n(t,r)?(t=parseFloat(t),r.min&&t<r.min?!1:r.max&&t>r.max?!1:!0):!1}),exports.register("url",function(t,r){return r.allowEmpty&&e.isEmpty(t)?!0:e.isUrl(t,r.separater)})});